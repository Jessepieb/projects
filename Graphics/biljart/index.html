<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Three.js practice</title>
    <style>
        html, body {
            margin: 0px;
        }

        canvas {
            position: absolute;
            overflow: hidden;
        }
    </style>
</head>
<body>

<!--<div id="label" style="position: absolute; color: black"></div>-->
<script src="js/three.js"></script>
<script src="Table.js"></script>
<script src="Ball.js"></script>
<script src="Wall.js"></script>
<script src="Pocket.js"></script>
<script src="Que.js"></script>
<script src="js/OrbitControls.js"></script>
<script>

    var camera, renderer, scene;
    const width = window.innerWidth;
    const height = window.innerHeight;

    var balls = [];
    const radius = 1;

    var table, que;

    let controls;

    let raycaster = new THREE.Raycaster();
    var mouse = new THREE.Vector2();


    function initCamera() {
        camera = new THREE.PerspectiveCamera(100, width / height, 0.5, 1000);
        camera.position.z = 15;
    }

    function initRenderer() {
        renderer = new THREE.WebGLRenderer();
        renderer.setSize(width, height);
    }

    function initControls() {
        controls = new THREE.OrbitControls(camera, renderer.domElement);
    }

    function init() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color('lightgray');

        table = new Table(width, height, scene);
        const ball = new Ball(0, 0, radius, scene);
        const ball2 = new Ball(-5, 0, radius, scene);
        //var que = new Que(ball.location.x,ball.location.y, scene);
        ball.mesh.name = "Ball";
        ball2.mesh.name = "Ball2";
        balls[0] = ball;
        balls[1] = ball2;
        //scene.add(balls);

        raycaster = new THREE.Raycaster()

        initCamera();
        initRenderer();
        initControls();

        document.body.appendChild(renderer.domElement);
    }

    document.onkeydown = checkKey;

    function checkKey(e) {
        e = e || window.event;
        var currVel = balls[0].velocity;
        if (e.keyCode == '38') {
            balls[0].applyForce(new THREE.Vector2(0, 0.04));
        } else if (e.keyCode == '40') {
            balls[0].applyForce(new THREE.Vector2(0, -0.04));
        } else if (e.keyCode == '37') {
            // balls[0].mesh.rotate.x += 1;
            balls[0].applyForce(new THREE.Vector2(-0.04, 0));

        } else if (e.keyCode == '39') {
            balls[0].applyForce(new THREE.Vector2(0.04, 0));
        }


    }

    window.addEventListener('resize', () => {
        renderer.setSize(window.innerWidth, window.innerHeight);
        camera.aspect = window.innerWidth / window.innerHeight;

        camera.updateProjectionMatrix();
    })

    window.addEventListener('mousemove', (event) => {
        mouse.x = event.x / window.innerWidth * 2 - 1;
        mouse.y = event.y / window.innerHeight * 2 - 1;
    })

    function checkCollision() {
        for (let i = 0; i < balls.length; i++) {
            for (let j = 0; j < balls.length; j++) {
                if (i != j) {
                    balls[i].Collide(balls[j]);
                    balls[j].Move();
                }
            }

            for (let p = 0; p < 3; p++) {
                table.pockets[p][0].Collide(balls[i]);
                table.pockets[p][1].Collide(balls[i]);
            }

            table.Collide(balls[i]);

            balls[i].Move();
        }
    }

    function animate() {
        requestAnimationFrame(animate);

        raycaster.setFromCamera(mouse, camera);

        checkCollision();
        controls.update();
        // document.getElementById("label").innerHTML = balls[0].location.toArray().toString();
        renderer.render(scene, camera);
    }

    init();
    console.log(scene.children);
    animate();
</script>
</body>
</html>