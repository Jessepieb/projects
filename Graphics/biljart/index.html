<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Three.js practice</title>
</head>
<body>
<div id="angle" style="position: absolute; color: white"></div>
<script src="js/three.js"></script>
<script>
    //to do add orbit control

    var camera, renderer, scene, controls;
    var geometry, material, texture;
    const width = window.innerWidth;
    const height = window.innerHeight;

    var table;
    var balls = new THREE.Group();
    var walls = new THREE.Group();
    var pockets = new THREE.Group();

    let amount = 5;
    let textureId = 1;
    var restart = 1;

    class Ball {
        constructor(col, row, txtID) {
            this.radius = 20 * (table.width / 1920);
            this.xDist = this.radius * 2.1;
            this.yDist = (this.radius * 2) + this.radius / 5;

            this.col = col;
            this.row = row;
            this.txtID = txtID;
            this.CreateBall(this.col, this.row);
        }

        CreateBall() {
            geometry = new THREE.SphereGeometry(this.radius, 32, 32);
            texture = new THREE.TextureLoader().load('models/textures/Ball' + textureId + '.jpg');
            material = new THREE.MeshBasicMaterial({map: texture});
            var sphere = new THREE.Mesh(geometry, material);
            sphere.position.x = (this.xDist * this.col);
            sphere.position.y = (this.yDist * -this.row);
            sphere.rotation.y += 11;
            angle.innerHTML= THREE.Math.radToDeg(sphere.rotation.y)%360;
            balls.add(sphere);
            textureId++;

        }

    }

    class Table {
        constructor() {
            // this.table = new THREE.Group();
            this.width = (innerWidth / 1920) * 55;
            this.height = this.width / 2;
            this.depth = 1.5;
            this.pockRad = 30 * (this.width / 1920);
        }

        initWalls() {
            this.createWall(0, this.height / 2 + this.depth / 2, this.width, this.depth);
            this.createWall(0, -1 * (this.height / 2 + this.depth / 2), this.width, this.depth);
            this.createWall(this.height + this.depth / 2, 0, this.depth, this.height + (this.depth * 2));
            this.createWall(-1 * (this.width / 2 + this.depth / 2), 0, this.depth, this.height + (this.depth * 2));
            scene.add(walls);
        }

        createBase() {

            geometry = new THREE.PlaneGeometry(this.width, this.height);
            texture = new THREE.TextureLoader().load('models/textures/Base.jpg');
            material = new THREE.MeshBasicMaterial({color: 0x009900});
            scene.add(new THREE.Mesh(geometry, material));
        }

        createWall(xloc, yloc, width, depth) {
            geometry = new THREE.BoxGeometry(width, depth, 2);
            texture = new THREE.TextureLoader().load('models/textures/wood1.jpg');
            material = new THREE.MeshBasicMaterial({map: texture});
            var wall = new THREE.Mesh(geometry, material);
            wall.position.x = xloc;
            wall.position.y = yloc;
            walls.add(wall);
        }

        initPockets() {
            this.createPocket(0, 0);
            scene.add(pockets);
        }

        createPocket(xloc, yloc) {
            geometry = new THREE.CylinderGeometry(this.pockRad, this.pockRad, 2);
            material = new THREE.MeshBasicMaterial({color: 0x000000});
            var pocket = new THREE.Mesh(geometry, material);
            pocket.rotation.x = Math.PI /2;
            pocket.position.x = xloc;
            pocket.position.y = yloc;
            pockets.add(pocket);
        }

    }

    function allignBalls() {
        const offset = table.width / 5;
        balls.rotation.z = 11;
        balls.position.x -= offset;
    }

    function spawnBalls() {
        var dif = 0.5;
        textureId = 1;
        new Ball(0, 1);
        for (let row = 2; row < amount + 1; row++) {
            for (let col = 0; col < row; col++) {
                new Ball((col - dif), row);
                if (col === row - 1) {
                    dif += 0.5;
                }
            }
        }
        scene.add(balls);
        allignBalls();
    }

    function spawnTable() {
        table = new Table();
        table.createBase();
        table.initWalls();
        table.initPockets();
    }

    function initCamera() {
        camera = new THREE.PerspectiveCamera(100, width / height, 0.1, 1000);
        camera.position.z = 15;
    }

    function initRenderer() {
        renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }

    function init() {
        scene = new THREE.Scene();
        initCamera();
        spawnTable();
        spawnBalls();
        initRenderer();
        document.body.appendChild(renderer.domElement);
    }

    function animate() {

        requestAnimationFrame(animate);
        renderer.render(scene, camera);
    }

    init();
    animate()
</script>
</body>
</html>